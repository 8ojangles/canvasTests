function bulletEmmisionFunct(){playerAlive&&(firing&&(currBullets>0&&(makeBullet(1),currBullets=0),0==currBullets&&counter-firingTime>=firingCooldown&&(currBullets++,firingTime=counter)),0==firing&&(firingTime=0,currBullets=1))}function makeBullet(e){for(var r=0;e>r;r++){var l={x:p.x,y:p.y,xVel:aimXVel,yVel:aimYVel,r:3};bullets.push(l)}}function bulletUpdater(){for(var e=bullets.length-1;e>=0;e--){var r=bullets[e];c.fillStyle="white",c.fillCircle(r.x,r.y,r.r),r.x+=r.xVel,r.y+=r.yVel,(r.x>canvas.width||r.x<0||r.y>canvas.height||r.y<0)&&bullets.splice(e,1)}}function draw(){frameRate=60,c.globalCompositeOperation="source-over",c.clearRect(0,0,canvas.width,canvas.height),startGame&&(populateAsteroids&&(10>asteroidsL?(makeAsteroidL(10),populateAsteroids=!1):makeAsteroidL(0)),20==gameTime&&1>currPowerUps&&(currPowerUps=1,powerUpThisTime=counter),1==currPowerUps&&(makePowerUp(1),currPowerUps--),asteroidLargeUpdater(),asteroidSmallUpdater(),explosionsUpdater(),bulletUpdater(),powerUpUpdater(),scoreTextUpdater(),bulletEmmisionFunct(),playerRender(),playerUpdate(),playerControls()),gameOverAnim(),counter++,debugOutput()}function randomPopulateX(){var e,r=random(50,75),l=random(0,2);return e=1>l?0-r:canvas.width+r}function randomPopulateY(){var e,r=random(50,75),l=random(0,2);return e=1>l?0-r:canvas.height+r}function makeAsteroidL(e){for(var r=0;e>r;r++){var l={x:randomPopulateX(),y:randomPopulateY(),xVel:random(-2,2),yVel:random(-2,2),score:100,r:50};asteroidsL.push(l)}}function asteroidLargeUpdater(){for(var e=asteroidsL.length-1;e>=0;e--){var r=asteroidsL[e];c.fillStyle=rgb(150,150,255),c.fillCircle(r.x,r.y,r.r),r.x+=r.xVel,r.y+=r.yVel,r.x>canvas.width+r.r&&(r.x=0-r.r),r.x<0-r.r&&r.xVel<0&&(r.x=canvas.width+r.r),r.y>canvas.height+r.r&&(r.y=0-r.r),r.y<0-r.r&&r.yVel<0&&(r.y=canvas.height+r.r);for(var l=bullets.length-1;l>=0;l--){var a=bullets[l],o=dist(a.x,a.y,r.x,r.y),t=a.r+r.r;if(t>=o){colPointX=r.x,colPointY=r.y;var i=r.score*scoreMultiplier;score+=i,makeScoreText(1,i),makeAsteroidS(10),makeExplosions(1),bullets.splice(l,1),asteroidsL.splice(e,1),multiplierTarget>0&&multiplierTarget--,0==multiplierTarget&&(scoreMultiplier+=1,multiplierTarget=10)}}}}function makeAsteroidS(e){for(var r=0;e>r;r++){var l={x:colPointX,y:colPointY,xVel:random(-2,2),yVel:random(-2,2),score:200,r:10};asteroidsS.push(l)}}function asteroidSmallUpdater(){for(var e=asteroidsS.length-1;e>=0;e--){var r=asteroidsS[e];c.fillStyle=rgb(150,150,255),c.fillCircle(r.x,r.y,r.r),r.x+=r.xVel,r.y+=r.yVel,r.x>canvas.width+r.r&&(r.x=0-r.r),r.x<0-r.r&&r.xVel<0&&(r.x=canvas.width+r.r),r.y>canvas.height+r.r&&(r.y=0-r.r),r.y<0-r.r&&r.yVel<0&&(r.y=canvas.height+r.r);for(var l=bullets.length-1;l>=0;l--){var a=bullets[l],o=dist(a.x,a.y,r.x,r.y),t=a.r+r.r;if(t>=o){colPointX=r.x,colPointY=r.y,makeExplosions(1);var i=r.score*scoreMultiplier;score+=i,makeScoreText(1,i),bullets.splice(l,1),asteroidsS.splice(e,1),multiplierTarget>0&&multiplierTarget--,0==multiplierTarget&&(scoreMultiplier+=1,multiplierTarget=10)}}}}function makePowerUp(e){for(var r=0;e>r;r++){var l={x:random(0,canvas.width),y:random(0,canvas.height),xVel:random(-2,2),yVel:random(-2,2),r:20,colR:0,colG:255,colB:0,colA:1};powerUps.push(l)}}function powerUpUpdater(){for(var e=powerUps.length-1;e>=0;e--){var r=powerUps[e];c.fillStyle=rgb(r.colR,r.colG,r.colB,r.colA),c.fillCircle(r.x,r.y,r.r);var l=dist(p.x,p.y,r.x,r.y),a=p.r+r.r;r.x+=r.xVel,r.y+=r.yVel,a>=l&&(makeExplosions(1),powerUps.splice(e,1),10==firingCooldown&&(firingCooldown=7,bulletSpeed=25)),r.x>canvas.width+r.r&&(r.x=0-r.r),r.x<0-r.r&&r.xVel<0&&(r.x=canvas.width+r.r),r.y>canvas.height+r.r&&(r.y=0-r.r),r.y<0-r.r&&r.yVel<0&&(r.y=canvas.height+r.r)}}function makeScoreText(e,r){for(var l=0;e>l;l++){var a={x:colPointX,y:colPointY,thisScore:r,colR:100,colG:100,colB:255,colA:1};scoreText.push(a)}}function scoreTextUpdater(){for(var e=scoreText.length-1;e>=0;e--){var r=scoreText[e];c.fillStyle=rgba(r.colR,r.colG,r.colB,r.colA),c.font="20pt arial",c.fillStyle="#ccc",c.fillText(r.thisScore,r.x,r.y),r.colR-=2,r.colG-=2,r.colA-=.05,r.y-=1,r.colA<=.05&&scoreText.splice(e,1)}}function makeExplosions(e){for(var r=0;e>r;r++){var l={x:colPointX,y:colPointY,colR:255,colG:255,colB:255,colA:1,line:20,r:10};explosions.push(l)}}function explosionsUpdater(){for(var e=explosions.length-1;e>=0;e--){var r=explosions[e];c.lineWidth=r.line,c.strokeStyle=rgba(r.colR,r.colG,r.colB,r.colA),c.strokeCircle(r.x,r.y,r.r),c.strokeCircle(r.x,r.y,.25*r.r),r.colG-=10,r.colB-=10,r.colA-=.05,r.r+=25,r.line-=2,r.colA<=.05&&explosions.splice(e,1)}}function makeStars(e){for(var r=0;e>r;r++){var l={x:random(0,canvas.width),y:random(0,canvas.height),colR:255,colG:255,colB:255,r:random(.5,1)};bgStars.push(l)}}function starsRenderer(){for(var e=bgStars.length-1;e>=0;e--){var r=bgStars[e];c.fillStyle=rgb(r.colR,r.colG,r.colB),c.fillCircle(r.x,r.y,r.r)}}var canvas=document.getElementById("myCanvas"),c=canvas.getContext("2d");canvas.width=window.innerWidth,canvas.height=window.innerHeight;var counter=0,score=0,scoreMultiplier=1,multiplierTarget=10,startGame=!1,gameOver=!1,populateAsteroids=!0,playerAlive=!0,playerCollision=!1,playerLives=3,powerUpTimer=1200,powerUpThisTime=0,powerUpTimerSet=!1,currPowerUps=0,gameTime,player={x:canvas.width/2,y:canvas.height/2,r:20,colR:150,colG:150,colB:150,xVel:0,yVel:0},firing=!1,firingTime=0,firingCooldown=10,currBullets=1,bulletSpeed=20,colPointX=0,colPointY=0,p=player,aimDeltaX,aimDeltaY,aimAngle,aimXVel,aimYVel,aimCalculation=function(){aimDeltaX=mouseX-p.x,aimDeltaY=mouseY-p.y,aimAngle=Math.atan2(aimDeltaY,aimDeltaX),aimXVel=Math.cos(aimAngle)*bulletSpeed,aimYVel=Math.sin(aimAngle)*bulletSpeed},playerRender=function(){playerAlive&&((playerLeftKey||playerRightKey)&&boosterXRender(),(playerUpKey||playerDownKey)&&boosterYRender(),c.fillStyle=rgb(p.colR,p.colG,p.colB),c.fillCircle(p.x,p.y,p.r),c.lineWidth=4,aimCalculation(),c.strokeStyle=rgb(200,0,0),c.save(),c.translate(p.x,p.y),c.rotate(aimAngle),c.beginPath(),c.moveTo(0,0),c.lineTo(20,0),c.stroke(),c.restore())},boosterXRender=function(){var e=random(50,150);if(c.globalCompositeOperation="lighter",playerLeftKey){var r=c.createLinearGradient(p.x,p.y-10,p.x+e,p.y+10);r.addColorStop(0,"rgba(255,255,255,1)"),r.addColorStop(1,"rgba(0,0,255,0)"),c.fillStyle=r,c.fillRect(p.x,p.y-10,e,20)}if(playerRightKey){var r=c.createLinearGradient(p.x,p.y-10,p.x-e,p.y+10);r.addColorStop(0,"rgba(255,255,255,1)"),r.addColorStop(1,"rgba(0,0,255,0)"),c.fillStyle=r,c.fillRect(p.x,p.y-10,-e,20)}c.globalCompositeOperation="source-over"},boosterYRender=function(){var e=random(50,150);if(c.globalCompositeOperation="lighter",playerUpKey){var r=c.createLinearGradient(p.x-10,p.y,p.x+10,p.y+e);r.addColorStop(0,"rgba(255,255,255,1)"),r.addColorStop(1,"rgba(0,0,255,0)"),c.fillStyle=r,c.fillRect(p.x-10,p.y,20,e)}if(playerDownKey){var r=c.createLinearGradient(p.x-10,p.y,p.x+10,p.y-e);r.addColorStop(0,"rgba(255,255,255,1)"),r.addColorStop(1,"rgba(0,0,255,0)"),c.fillStyle=r,c.fillRect(p.x-10,p.y,20,-e)}c.globalCompositeOperation="source-over"},boundaryWrap=function(){p.x>canvas.width+p.r&&(p.x=0-p.r),p.x<0-p.r&&p.xVel<0&&(p.x=canvas.width),p.y>canvas.height&&(p.y=0-p.r),p.y<0-p.r&&p.yVel<0&&(p.y=canvas.height)},playerUpdate=function(){if(playerAlive&&playerLives>0){boundaryWrap(),p.x+=p.xVel,p.y+=p.yVel;for(var e=asteroidsL.length-1;e>=0;e--){aL=asteroidsL[e];var r=dist(p.x,p.y,aL.x,aL.y),l=p.r+aL.r;l>=r&&(colPointX=aL.x,colPointY=aL.y,p.x=null,p.y=null,thisTime=counter,playerCollision=!0,playerLives-=1,playerAlive=!1,asteroidsL.splice(e,1),makeAsteroidS(10),makeExplosions(1),scoreMultiplier=1,multiplierTarget=10,firingCooldown=10,bulletSpeed=20)}for(var e=asteroidsS.length-1;e>=0;e--){aS=asteroidsS[e];var r=dist(p.x,p.y,aS.x,aS.y),l=p.r+aS.r;l>=r&&(colPointX=aS.x,colPointY=aS.y,p.x=null,p.y=null,thisTime=counter,playerCollision=!0,playerLives-=1,playerAlive=!1,asteroidsS.splice(e,1),makeExplosions(1),scoreMultiplier=1,multiplierTarget=10,firingCooldown=10,bulletSpeed=20)}}playerCollision&&playerLives>0&&counter-thisTime>=120&&(playerAlive=!0,playerCollision=!1,p.x=canvas.width/2,p.y=canvas.height/2,p.xVel=0,p.yVel=0),0>=playerLives&&(gameOver=!0,startGame=!1)},bullets=[],asteroidsL=[],asteroidsS=[],powerUps=[],scoreText=[],explosions=[],bgStars=[],initGame=function(){score=0,startGame=!1,gameOver=!1,populateAsteroids=!0,playerAlive=!0,playerCollision=!1,playerLives=3,p.x=canvas.width/2,p.y=canvas.height/2,p.yVel=0,p.xVel=0,gT.colA=1,asteroidsL.length=0,asteroidsS.length=0,explosions.length=0,bullets.length=0},gameOverText={colR:255,colG:255,colB:255,colA:1,font:"50pt arial",x:canvas.width/2,y:canvas.height/2,align:"center"},gT=gameOverText,gameOverAnim=function(){gameOver&&(startGame=!1,c.font=gT.font,c.fillStyle=rgba(gT.colR,gT.colG,gT.colB,gT.colA),c.textAlign=gT.align,c.fillText("GAME OVER",gT.x,gT.y),c.font="50pt arial",c.fillText("SCORE: "+score,gT.x,gT.y+120),gT.colA-=.005,counter%240==0&&($(".startButton.off").removeClass("off").addClass("on"),$(".playerControls.off").removeClass("off").addClass("on"),initGame()))},debugOutput=function(){c.textAlign="center",c.font="20pt arial",c.fillStyle="#ccc",c.fillText("score "+score,canvas.width/2,50),c.fillText("multiplier "+scoreMultiplier,canvas.width/2-200,50),c.fillText("playerLives "+playerLives,200,50),c.fillText("powerUpTimerSet "+powerUpTimerSet,300,900),gameTime=parseInt((counter-powerUpThisTime)/60,10),c.fillText("gameTime "+gameTime,300,1e3)};